- name: Deploy Argocd and apps
  hosts: kubernetes
  gather_facts: false
 
  pre_tasks:
    - name: cluster preparation
      include_role:
        name: prepare-cluster
      tags: [configuration]

  tasks:
    - name: Install argocd
      include_role:
        name: argocd
      tags: [argocd]
  
  post_tasks:
    - name: Vérifier les applications ArgoCD créées
      kubernetes.core.k8s_info:
        api_version: argoproj.io/v1alpha1
        kind: Application
        namespace: "{{ argocd.namespace }}"
        kubeconfig: "{{ kubeconfig_path }}"
      register: argocd_apps
    
